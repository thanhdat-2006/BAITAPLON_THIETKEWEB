<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đánh Giá Tour - Viettravel</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

    <header>
        <div class="container">
            <div class="logo">
                <a href="index.html">
                    <img src="assets/images/logoweb.png" alt="Viettravel Logo" class="logo-img">
                </a>
            </div>
            <button id="nav-toggle" class="nav-toggle" aria-label="Mở menu" aria-expanded="false">
                <span class="hamburger"></span>
            </button>
            <nav>
                <ul class="nav-links">
                    <li><a href="index.html">Trang chủ</a></li>
                    <li><a href="destinations.html">Điểm đến</a></li>
                    <li><a href="tours.html">Tours</a></li>
                    <li><a href="hotels.html">Dịch vụ</a></li>
                    <li><a href="booking-history.html">Lịch sử</a></li>
                    <li><a href="evaluations.html">Đánh giá</a></li>
                    <li><a href="contact.html" class="btn-contact">Liên hệ</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="page-banner">
        <div class="banner-content"><h2>Đánh Giá Tour</h2></div>
    </section>

    <section class="section-padding container">
        <div class="section-title">
            <h3>Chia sẻ trải nghiệm của bạn</h3>
            <p>Giúp chúng tôi cải thiện chất lượng dịch vụ</p>
        </div>

        <div class="evaluation-box" aria-live="polite">
            <div id="success-msg">Cảm ơn bạn đã gửi đánh giá! Bạn sẽ được chuyển đến trang Đánh giá.</div>

            <form id="evaluation-form">
                <div class="field">
                    <label>Tour được đánh giá:</label>
                    <div id="tour-name" style="font-weight:700; color:#00a2a2;">(Chưa chọn)</div>
                    <div style="font-size:.95rem; color:#666;" id="booking-code"></div>
                </div>

                <div class="field">
                    <label>Đánh giá chung:</label>
                    <div class="rating" role="radiogroup" aria-label="Đánh giá sao">
                        <input type="radio" name="rating" id="r5" value="5"><label for="r5" title="5 sao">★</label>
                        <input type="radio" name="rating" id="r4" value="4"><label for="r4" title="4 sao">★</label>
                        <input type="radio" name="rating" id="r3" value="3"><label for="r3" title="3 sao">★</label>
                        <input type="radio" name="rating" id="r2" value="2"><label for="r2" title="2 sao">★</label>
                        <input type="radio" name="rating" id="r1" value="1"><label for="r1" title="1 sao">★</label>
                    </div>
                    <div id="rating-error" style="color:#d32f2f; display:none; font-size:.95rem; margin-top:8px;">Vui lòng chọn số sao trước khi gửi.</div>
                </div>

                <!-- Email đã bỏ: chỉ cần chọn sao và gửi -->

                <div style="display:flex; gap:10px; align-items:center; margin-top:16px;">
                    <button type="submit" class="btn-primary" style="border:none; padding:10px 18px; cursor:pointer;">Gửi đánh giá</button>
                    <a href="booking-history.html" class="btn-secondary" style="padding:10px 14px; text-decoration:none;">Quay lại Lịch sử</a>
                </div>
            </form>
        </div>

        <p style="margin-top:18px; color:#666; font-size:.95rem;">Lưu ý: Bạn có thể mở trang đánh giá trực tiếp từ Lịch sử đặt vé bằng nút "Đánh giá".</p>
    </section>

    <footer>
        <div class="container footer-content">
            <div class="footer-col">
                <div class="footer-logo">
                    <img src="assets/images/logoweb.png" alt="Viettravel Logo">
                </div>
                <p>Thổi bùng đam mê du lịch và khám phá.</p>
                <div id="footer-datetime" class="footer-datetime" aria-live="polite"></div>
            </div>
            <div class="footer-col">
                <h4>Liên kết</h4>
                <ul>
                    <li><a href="index.html">Trang chủ</a></li>
                    <li><a href="destinations.html">Điểm đến</a></li>
                    <li><a href="tours.html">Tours</a></li>
                    <li><a href="hotels.html">Dịch vụ</a></li>
                    <li><a href="booking-history.html">Lịch sử</a></li>
                    <li><a href="evaluations.html">Đánh giá</a></li>
                    <li><a href="contact.html">Liên hệ</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h4>Đối tác hợp tác</h4>
                <div class="partners-list" aria-label="Đối tác hợp tác">
                    <div class="partner-item">
                        <a href="https://www.traveloka.com/vi-vn" target="_blank" rel="noopener noreferrer">
                            <img src="assets/images/partners/partner_1.jpg" alt="Đối tác 1">
                        </a>
                    </div>
                    <div class="partner-item">
                        <a href="https://www.flightcentre.com.au/" target="_blank" rel="noopener noreferrer">
                            <img src="assets/images/partners/partner_2.jpg" alt="Đối tác 2">
                        </a>
                    </div>
                    <div class="partner-item">
                        <a href="https://www.ivivu.com/" target="_blank" rel="noopener noreferrer">
                            <img src="assets/images/partners/partner_3.jpg" alt="Đối tác 3">
                        </a>
                    </div>
                    <div class="partner-item">
                        <a href="https://www.americanexpress.com/" target="_blank" rel="noopener noreferrer">
                            <img src="assets/images/partners/partner_4.jpg" alt="Đối tác 4">
                        </a>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h4>Phương thức thanh toán</h4>
                <div class="payments-list" aria-label="Đối tác thanh toán">
                    <a href="https://www.visa.com" target="_blank" rel="noopener noreferrer" class="payment-item">
                        <img src="assets/images/payments/payment_1.png" alt="Visa">
                    </a>
                    <a href="https://www.mastercard.com" target="_blank" rel="noopener noreferrer" class="payment-item">
                        <img src="assets/images/payments/payment_2.png" alt="Mastercard">
                    </a>
                    <a href="https://www.vn.jcb/vi/index.html" target="_blank" rel="noopener noreferrer" class="payment-item">
                        <img src="assets/images/payments/payment_3.png" alt="JCB">
                    </a>
                    <a href="https://www.momo.vn/" target="_blank" rel="noopener noreferrer" class="payment-item">
                        <img src="assets/images/payments/payment_4.png" alt="Momo">
                    </a>
                </div>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2025 Viettravel. All rights reserved.|Support 24/24</p>
        </div>
    </footer>

    <!-- Script: prefill tour info from query params, save evaluation to localStorage and redirect -->
    <script>
        (function(){
            function getQueryParam(key) {
                return new URLSearchParams(window.location.search).get(key);
            }

            var tourNameEl = document.getElementById('tour-name');
            var bookingCodeEl = document.getElementById('booking-code');
            var successMsg = document.getElementById('success-msg');
            var bookingId = getQueryParam('bookingId') || '';
            var tourName = getQueryParam('tourName') || '';

            if (tourName) {
                tourNameEl.textContent = decodeURIComponent(tourName);
            }
            if (bookingId) {
                bookingCodeEl.textContent = 'Mã đơn: ' + decodeURIComponent(bookingId);
            }

            document.getElementById('evaluation-form').addEventListener('submit', function(e){
                e.preventDefault();
                
                // Không yêu cầu email ở form đánh giá (bỏ trường email)
                var email = '';
                
                var rating = document.querySelector('input[name="rating"]:checked');
                var ratingValue = rating ? parseInt(rating.value, 10) : 0;
                var ratingErrorEl = document.getElementById('rating-error');
                if (!ratingValue || ratingValue <= 0) {
                    if (ratingErrorEl) ratingErrorEl.style.display = 'block';
                    return;
                } else {
                    if (ratingErrorEl) ratingErrorEl.style.display = 'none';
                }

                var entry = {
                    order: bookingId || ('bkg_' + Date.now()),
                    bookingId: bookingId,
                    tourName: tourName || tourNameEl.textContent,
                    email: email,
                    rating: ratingValue,
                    date: new Date().toISOString()
                };

                try {
                    var existing = JSON.parse(localStorage.getItem('evaluations') || '[]');
                    existing.push(entry);
                    localStorage.setItem('evaluations', JSON.stringify(existing));
                } catch (err) {
                    console.error('Lỗi lưu đánh giá', err);
                }

                successMsg.style.display = 'block';
                // Chuyển đến trang hiển thị đánh giá
                setTimeout(function(){
                    window.location.href = 'evaluations.html';
                }, 900);
            });
        })();
    </script>

    <!-- Script: cập nhật thời gian ở footer -->
    <script>
        function updateFooterDatetime() {
            const el = document.getElementById('footer-datetime');
            if (!el) return;
            const now = new Date();
            const dateStr = now.toLocaleDateString('vi-VN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            const timeStr = now.toLocaleTimeString('vi-VN', { hour12: false });
            el.textContent = `${dateStr} — ${timeStr}`;
        }
        updateFooterDatetime();
        setInterval(updateFooterDatetime, 1000);
    </script>

    <!-- Script: Save evaluation to localStorage -->
    <script>
        function saveEvaluation(payload) {
            const KEY = 'evaluations';
            const arr = JSON.parse(localStorage.getItem(KEY) || '[]');
            const item = Object.assign({}, payload, {
                date: payload.date || new Date().toISOString(),
                comment: (payload.comment ?? '').toString()
            });
            arr.push(item);
            localStorage.setItem(KEY, JSON.stringify(arr));
        }
    </script>

</body>
</html>